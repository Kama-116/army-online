<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Army Online Live</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #1a1a1a; color: white; text-align: center; font-family: 'Arial', sans-serif; margin: 0; overflow: hidden; user-select: none; }
        
        /* –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ */
        .top-bar { display: flex; background: rgba(0,0,0,0.9); padding: 8px 5px; font-size: 11px; justify-content: space-around; border-bottom: 2px solid #f1c40f; position: relative; z-index: 100; }
        .val { color: #f1c40f; font-weight: bold; font-size: 13px; }

        /* –ü–û–ó–´–í–ù–û–ô */
        .nickname-area { position: absolute; top: 50px; left: 15px; z-index: 80; }
        #player-nick { background: rgba(0,0,0,0.6); padding: 4px 10px; border-radius: 5px; border-left: 3px solid #f1c40f; font-weight: bold; font-size: 14px; }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .right-nav { position: absolute; right: 10px; top: 70px; display: flex; flex-direction: column; gap: 10px; z-index: 50; }
        .nav-btn { width: 50px; height: 50px; background: rgba(44, 62, 80, 0.9); border: 2px solid #f1c40f; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; }

        /* –ö–ê–ó–ê–†–ú–ê + –ê–ù–ò–ú–ê–¶–ò–Ø –î–´–•–ê–ù–ò–Ø –ì–ì */
        #main-view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; display: flex; align-items: center; justify-content: center; }
        #char-img { 
            max-width: 90%; max-height: 80%; object-fit: contain; 
            animation: breathing 4s ease-in-out infinite !important;
            will-change: transform;
        }
        @keyframes breathing {
            0%, 100% { transform: scale(1) translateY(0); filter: brightness(1); }
            50% { transform: scale(1.03) translateY(-5px); filter: brightness(1.1); }
        }

        /* –û–ö–ù–ê */
        .window { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; display: none; flex-direction: column; align-items: center; }
        #win-bosses { background: #d2b48c; padding-top: 20px; color: #3d2b1f; }

        /* –ê–†–ï–ù–ê –ë–û–Ø */
        #battle-arena { background: #000; z-index: 2000; justify-content: center; align-items: center; }
        
        /* –ë–û–°–° –ò –ï–ì–û –ê–ù–ò–ú–ê–¶–ò–ò */
        .boss-container { position: relative; width: 100%; height: 60%; display: flex; align-items: center; justify-content: center; }
        #boss-bg { max-width: 95%; max-height: 100%; object-fit: contain; transition: filter 0.1s; }
        
        /* –ö–ª–∞—Å—Å —Å–ø–æ–∫–æ–π–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è –±–æ—Å—Å–∞ */
        .boss-idle-active { animation: boss-sway 5s ease-in-out infinite !important; }
        @keyframes boss-sway {
            0%, 100% { transform: rotate(-1deg) translateY(0); }
            50% { transform: rotate(1deg) translateY(15px); }
        }

        /* –ö–ª–∞—Å—Å —Ä–µ–∑–∫–æ–≥–æ —É–¥–∞—Ä–∞ –±–æ—Å—Å–∞ */
        .boss-striking { animation: boss-jump 0.4s ease-out !important; }
        @keyframes boss-jump {
            0% { transform: scale(1); }
            50% { transform: scale(1.25) translateY(40px); filter: brightness(1.5) contrast(1.2); }
            100% { transform: scale(1); }
        }

        /* –ò–ù–¢–ï–†–§–ï–ô–° –ë–û–Ø */
        .boss-header { position: absolute; top: 15px; left: 15px; text-align: left; z-index: 2010; }
        .hp-box { width: 200px; height: 20px; background: #333; border: 1.5px solid #fff; position: relative; border-radius: 4px; overflow: hidden; }
        #boss-hp-fill { height: 100%; background: #c0392b; width: 100%; transition: width 0.3s; }
        #hp-text { position: absolute; width: 100%; text-align: center; font-size: 12px; top: 1px; font-weight: bold; color: white; text-shadow: 1px 1px #000; }

        #damage-stats-box { position: absolute; bottom: 130px; width: 85%; height: 70px; background: rgba(0,0,0,0.7); border: 1px solid #f1c40f; border-radius: 5px; overflow-y: auto; padding: 5px; font-size: 11px; text-align: left; }
        
        .attack-panel { position: absolute; bottom: 15px; width: 100%; display: flex; justify-content: center; gap: 8px; background: rgba(0,0,0,0.8); padding: 10px 0; }
        .skill-btn { width: 65px; height: 65px; border: 2px solid #f1c40f; border-radius: 12px; overflow: hidden; background: #000; position: relative; }
        .skill-btn img { width: 100%; height: 100%; object-fit: cover; mix-blend-mode: lighten; }

        .shake { animation: shake-screen 0.3s; }
        @keyframes shake-screen {
            0%, 100% { transform: translate(0,0); }
            25% { transform: translate(5px, -5px); }
            75% { transform: translate(-5px, 5px); }
        }

        .exit-btn { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.5); border: 1px solid #fff; color: #fff; padding: 6px 12px; z-index: 2020; border-radius: 5px; }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="stat-item">–ú–ï–î–ê–õ–ò: <span class="val" id="score">0</span></div>
        <div class="stat-item">–†–£–ë–õ–ò: <span class="val" id="money">100</span></div>
    </div>

    <div class="nickname-area"><div id="player-nick" onclick="changeNickname()">–ë–æ–µ—Ü</div></div>

    <div class="right-nav">
        <div class="nav-btn" onclick="showWin('bosses')">üíÄ</div>
        <div class="nav-btn" onclick="closeWins()">üè†</div>
    </div>

    <div id="main-view">
        <img id="char-img" src="https://github.com/Kama-116/army-online/blob/main/rank1.JPG?raw=true">
    </div>

    <div id="battle-arena" class="window">
        <button class="exit-btn" onclick="exitBattle()">–°–ë–ï–ñ–ê–¢–¨</button>
        
        <div class="boss-header">
            <b style="font-size: 18px; text-transform: uppercase;">–ï—Ñ—Ä–µ–π—Ç–æ—Ä –ë–æ–∫–æ–≤</b>
            <div class="hp-box">
                <div id="boss-hp-fill"></div>
                <div id="hp-text">1000 / 1000</div>
            </div>
        </div>
        
        <div class="boss-container">
            <img id="boss-bg" class="boss-idle-active" src="https://github.com/Kama-116/army-online/blob/main/bossBokov1.jpg?raw=true">
        </div>

        <div id="damage-stats-box"><div id="stats-content">–ü—Ä–∏–≥–æ—Ç–æ–≤—å—Å—è –∫ –±–æ—é...</div></div>

        <div class="attack-panel">
            <div class="skill-btn" onclick="useSkill(0, '–ì–æ–ª–æ–≤–∞')"><img src="https://github.com/Kama-116/army-online/blob/main/vgolovy.jpg?raw=true"></div>
            <div class="skill-btn" onclick="useSkill(1, '–ó–∞–¥')"><img src="https://github.com/Kama-116/army-online/blob/main/vzad.jpg?raw=true"></div>
            <div class="skill-btn" onclick="useSkill(2, '–ì–ª–∞–∑–∞')"><img src="https://github.com/Kama-116/army-online/blob/main/vglaza.jpg?raw=true"></div>
            <div class="skill-btn" onclick="useSkill(3, '–ì—Ä—É–¥—å')"><img src="https://github.com/Kama-116/army-online/blob/main/vgryd.jpg?raw=true"></div>
        </div>
    </div>

    <div id="win-bosses" class="window">
        <h2>–õ–ò–ß–ù–´–ï –î–ï–õ–ê</h2>
        <div style="background: rgba(255,255,255,0.5); padding: 15px; margin: 10px; border: 2px solid #000;" onclick="startBattle()">
            <b>–ï–§–†–ï–ô–¢–û–† –ë–û–ö–û–í</b><br>HP: 1000<br><br>
            <button style="padding: 10px; background: #000; color: #fff; border: none; font-weight: bold;">–ù–ê–ß–ê–¢–¨ –ë–û–ô</button>
        </div>
        <button onclick="closeWins()" style="margin-top: 20px;">–ó–ê–ö–†–´–¢–¨ –ü–ê–ü–ö–£</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        let score = parseInt(localStorage.getItem('score')) || 0;
        let money = parseInt(localStorage.getItem('money')) || 100;
        let nick = localStorage.getItem('playerNick') || "–ë–æ–µ—Ü";
        let bossHP = parseInt(localStorage.getItem('bossHP')) || 1000;
        const bossMaxHP = 1000;

        function updateUI() {
            document.getElementById('score').innerText = score;
            document.getElementById('money').innerText = money;
            document.getElementById('player-nick').innerText = nick;
            
            document.getElementById('boss-hp-fill').style.width = (bossHP / bossMaxHP * 100) + "%";
            document.getElementById('hp-text').innerText = bossHP + " / " + bossMaxHP;
        }

        // –¶–ò–ö–õ –ê–¢–ê–ö–ò –ë–û–°–°–ê
        setInterval(() => {
            const arena = document.getElementById('battle-arena');
            const bossImg = document.getElementById('boss-bg');
            if (arena.style.display === 'flex') {
                bossImg.classList.remove('boss-idle-active');
                bossImg.classList.add('boss-striking');
                
                try { tg.HapticFeedback.notificationOccurred('warning'); } catch(e) {}

                setTimeout(() => {
                    bossImg.classList.remove('boss-striking');
                    bossImg.classList.add('boss-idle-active');
                }, 400);
            }
        }, 6000);

        function useSkill(idx, name) {
            let damage = [35, 25, 20, 45][idx];
            bossHP = Math.max(0, bossHP - damage);

            // –¢—Ä—è—Å–∫–∞ —ç–∫—Ä–∞–Ω–∞
            let arena = document.getElementById('battle-arena');
            arena.classList.add('shake');
            setTimeout(() => arena.classList.remove('shake'), 300);

            // –í—Å–ø—ã—à–∫–∞ —É—Ä–æ–Ω–∞ –Ω–∞ –±–æ—Å—Å–µ
            let b = document.getElementById('boss-bg');
            b.style.filter = "brightness(2) sepia(1) saturate(3)";
            setTimeout(() => b.style.filter = "", 200);

            // –õ–æ–≥ –±–æ—è
            let log = document.getElementById('stats-content');
            log.innerHTML = `<div><b>${nick}</b>: —É—Ä–æ–Ω ${damage} (${name})</div>` + log.innerHTML;

            if (bossHP < 500) b.src = "https://github.com/Kama-116/army-online/blob/main/bossBokov2.jpg?raw=true";
            
            if (bossHP <= 0) {
                tg.showAlert("–ë–û–°–° –ü–û–í–ï–†–ñ–ï–ù!");
                score += 500;
                bossHP = 1000;
                exitBattle();
            }
            
            updateUI();
            save();
            try { tg.HapticFeedback.impactOccurred('heavy'); } catch(e) {}
        }

        function changeNickname() {
            let p = prompt("–¢–≤–æ–π –ø–æ–∑—ã–≤–Ω–æ–π:", nick);
            if (p) { nick = p; save(); updateUI(); }
        }

        function startBattle() { closeWins(); document.getElementById('battle-arena').style.display = 'flex'; updateUI(); }
        function exitBattle() { document.getElementById('battle-arena').style.display = 'none'; }
        function showWin(id) { document.getElementById('win-' + id).style.display = 'flex'; }
        function closeWins() { document.querySelectorAll('.window').forEach(w => w.style.display = 'none'); }
        
        function save() {
            localStorage.setItem('score', score);
            localStorage.setItem('money', money);
            localStorage.setItem('bossHP', bossHP);
            localStorage.setItem('playerNick', nick);
        }

        updateUI();
    </script>
</body>
</html>